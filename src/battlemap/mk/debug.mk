################################################################################
## CONFIG ######################################################################
################################################################################
DIALYZER_PLT_FILE ?= tacticians-server.plt
DIALYZER ?= dialyzer

################################################################################
## MAKEFILE MAGIC ##############################################################
################################################################################
SRC_FILES ?= $(wildcard $(SRC_DIR)/*.erl $(SRC_DIR)/*/*.erl)

################################################################################
## SANITY CHECKS ###############################################################
################################################################################

################################################################################
## TARGET RULES ################################################################
################################################################################
DEBUG_RESULT = $(DIALYZER_PLT_FILE)

debug_rebuild:
	$(MAKE) clean
	$(MAKE) ERLC_OPTS=+debug_info

################################################################################
## INTERNAL RULES ##############################################################
################################################################################
ifeq ($(wildcard $(DIALYZER_PLT_FILE)),)
debug_run:
	$(DIALYZER) --build_plt --apps erts kernel stdlib jiffy --output_plt \
		$(DIALYZER_PLT_FILE)
	$(MAKE) debug_rebuild
	$(DIALYZER) --add_to_plt --plt $(DIALYZER_PLT_FILE) -r $(BIN_DIR)
else
debug_run:
	$(MAKE) debug_rebuild
	$(DIALYZER) --check_plt --plt $(DIALYZER_PLT_FILE)
	$(DIALYZER) --get_warnings $(SRC_DIR)/*.erl $(SRC_DIR)/*/*.erl \
		--src --plt $(DIALYZER_PLT_FILE)
endif
