################################################################################
## CONFIG ######################################################################
################################################################################
ERLC ?= erlc
ERLC_OPTS ?=

################################################################################
## MAKEFILE MAGIC ##############################################################
################################################################################
SRC_FILES ?= $(wildcard $(SRC_DIR)/*.erl $(SRC_DIR)/*/*.erl)
BIN_FILES = \
	$(patsubst %.erl,$(BIN_DIR)/%.beam,$(notdir $(SRC_FILES)))

################################################################################
## SANITY CHECKS ###############################################################
################################################################################

################################################################################
## TARGET RULES ################################################################
################################################################################
ERLANG_RESULT = $(BIN_DIR) $(BIN_FILES)

################################################################################
## INTERNAL RULES ##############################################################
################################################################################
.SECONDEXPANSION:
$(BIN_FILES): $(BIN_DIR)/%.beam : $$(wildcard $(SRC_DIR)/*/%.erl $(SRC_DIR)/%.erl)
	$(ERLC) $(ERLC_OPTS) -o $(BIN_DIR) $<
